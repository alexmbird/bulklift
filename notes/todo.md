# Improvements / Roadmap

-   [X] <strike>Delete target directories no longer referenced by manifests (i.e. media you no longer want on devices)</strike>
-   [X] <strike>`test` subcommand, to run through all manifests in the tree and check validity</strike>
-   [X] <strike>Save a signature in each target directory generated from (codec, bitrate, codec_release, metadata) and automatically regenerate media when these things change</strike>
-   [X] <strike>BUGFIX: subdirectories of dirs with `enabled=true` are not handled well</strike>
-   [X] <strike>Handle ctrl+c during transcoding more gracefully</strike>
-   [X] <strike>Store a `codec_version` field in signature so targets can be regenerated when better-performing versions are released</strike>
-   [X] <strike>QUALITY: Dedicated dict-like object for `target`s with sane defaults</strike>
-   [X] <strike>Separately configure number of threads for encoding and r128gain</strike>
-   [X] <strike>Override template used to generate target album path from metadata; the default one doesn't suit mixes & soundtracks</strike>
-   [X] <strike>Filters to include/exclude files from a dir by list/glob</strike>
-   [X] <strike>Process media files in reverse order of size, which keeps back the smallest ones to feed cores at the end of the job</strike>
-   [X] <strike>FEATURE: fix output filenames for vfat</strike>
-   [X] <strike>BUGFIX: Recognise .ogg as an audio format</strike>
-   [X] <strike>IMPROVEMENT: use dest filename in signature; vfat sanitization might cause it to change</strike>
-   [X] <strike>Transcode for only one target in a single run.  This fits the model of updating a media library on an occasionally-connected device, e.g. a phone mounted with fuse-mtp.</strike>
-   [X] <strike>FEATURE: Optionally overwrite metadata in target files with `format()`-ed metadata fields (example: strip track numbers from a dir of random files)</strike>
-   [X] <strike>`gain` setting makes more sense under `config` than per-target</strike>
-   [X] <strike>BUGFIX: some ffmpeg versions don't handle `-map ...?` syntax (actually ffmpeg+libopus doesn't like embedded artwork)</strike>
-   [X] <strike>QUALITY: change `vfat_sanitize()` to use whitelist (including `string.ascii_letters`) rather than blacklist.  This will exclude strange unicode.</strike>
-   [X] <strike>QUALITY: `functools.lru_cache` for loading manifests</strike>
-   [X] <strike>IMPROVEMENT: when there are multiple outputs, transcode to both in a single ffmpeg run</strike>
-   [X] <strike>QUALITY: make signatures less sensitive to changes in yaml formatting</strike>
-   [X] <strike>Unit testing against real (generated) trees of files</strike>
-   [ ] QUALITY: use a `TargetTree` object to handle chown/chmod/cleanup
-   [ ] QUALITY: type hinting
-   [ ] FEATURE: "virtual" sources.  Run an external command (e.g. `wget ...`) to get media from elsewhere
-   [ ] FEATURE: config param for size of target and alert when it has been exceeded
-   [ ] QUALITY: Switch to [ruaml.yaml](https://yaml.readthedocs.io/en/latest/overview.html) for more control over yaml formatting
-   [ ] Switch single use path modifications to [`PurePath.joinpath`](https://docs.python.org/3.5/library/pathlib.html#pathlib.PurePath.joinpath)
-   [ ] Check manifest content in test mode, not just yaml parsing
-   [ ] Test new manifests after they get created in edit mode
-   [ ] Extra output formats (m4a)
-   [ ] Release on PyPy
-   [ ] Static release builds
-   [ ] QUALITY: [f-strings](https://realpython.com/python-f-strings/) for readability (but not until Python >= 3.6 is more common)
